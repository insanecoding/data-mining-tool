buildscript {
    ext {
        springBootVersion = '1.4.2.RELEASE'
    }
    repositories {
        maven { url 'http://repo.spring.io/plugins-release'}
        maven { url "https://plugins.gradle.org/m2/" }
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath 'org.springframework:springloaded:1.2.0.RELEASE'
        classpath 'org.springframework.build.gradle:propdeps-plugin:0.0.7'
        classpath "com.moowork.gradle:gradle-node-plugin:1.0.1"
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'org.springframework.boot'
apply plugin: 'propdeps'
apply plugin: 'propdeps-maven'
apply plugin: 'propdeps-idea'
apply plugin: 'propdeps-eclipse'
apply plugin: "com.moowork.node"

jar {
    baseName = 'data-mining-tool'
    version = '0.0.1-SNAPSHOT'
}
sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    maven { url 'http://repo.spring.io/plugins-release'}
    maven {
        url "https://plugins.gradle.org/m2/"
    }
    mavenCentral()
}


dependencies {
    // web
    compile('org.springframework.boot:spring-boot-starter-web')
    compile('org.springframework.boot:spring-boot-starter-websocket')
    compile ('org.springframework.boot:spring-boot-starter-undertow:1.4.2.RELEASE')
    compile group: 'io.undertow', name: 'undertow-websockets-jsr', version: '1.4.6.Final'
    // db
    compile('org.springframework.boot:spring-boot-starter-data-jpa')
    compile ('com.zaxxer:HikariCP')
    compile('org.springframework.boot:spring-boot-starter-jdbc')
    runtime('com.h2database:h2')
    runtime('org.postgresql:postgresql')
    // misc
    compile('org.springframework.boot:spring-boot-starter-aop')
    optional('org.springframework.boot:spring-boot-devtools')
    compileOnly('org.projectlombok:lombok')
    compile group: 'com.google.guava', name: 'guava', version: '20.0'
    // test
    testCompile('org.springframework.boot:spring-boot-starter-test')
    //    logging
    compile group: 'ch.qos.logback', name: 'logback-core', version: '1.1.7'
    compile group: 'ch.qos.logback', name: 'logback-classic', version: '1.1.7'
    compile group: 'org.slf4j', name: 'jcl-over-slf4j', version: '1.7.21'
    compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.21'
}

configurations {
    compile.exclude module: "spring-boot-starter-tomcat"
    compile.exclude module: "tomcat-jdbc"
    compile.exclude module: 'undertow-websockets-jsr'
}

task myScript(type: NodeTask) {
    args = ['arg1', 'arg2']
}

task installFrontend(type: YarnTask) {
    // add the express package only
    args = ['install']
    execOverrides {
        it.workingDir = "${project.projectDir}/src/main/frontend"
    }
}

task buildProduction(type: YarnTask) {
    // add the express package only
    args = ['build']
    execOverrides {
        it.workingDir = "${project.projectDir}/src/main/frontend"
    }
}

node {
    // Version of node to use.
    version = '6.9.1'

    // Version of npm to use.
    npmVersion = '3.10.10'

    // Version of Yarn to use.
    yarnVersion = '0.17.10'

    // Base URL for fetching node distributions (change if you have a mirror).
    distBaseUrl = 'https://nodejs.org/dist'

    // If true, it will download node using above parameters.
    // If false, it will try to use globally installed node.
    download = true

    // Set the work directory for unpacking node
    workDir = file("${project.buildDir}/nodejs")

    // Set the work directory for NPM
    npmWorkDir = file("${project.buildDir}/npm")

    // Set the work directory for Yarn
    yarnWorkDir = file("${project.buildDir}/yarn")

    // Set the work directory where node_modules should be located
    nodeModulesDir = file("${project.projectDir}")
}

springBoot {
    mainClass = "com.me.DataMiningApplication"
}